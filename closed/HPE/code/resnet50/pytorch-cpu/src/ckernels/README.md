# C++ kernel source code generated by Graph Compiler

The repo includes the auto-generated MLP and RN50 backbone code by Graph
Compiler, and the necessary runtime support code.

Requirements:
 * GCC 10.0+
 * cmake
 * SPR machine

## Clone the repo

```bash
git clone https://github.com/intel-sandbox/graphcompiler-mlperf --recursive
```

## Standalone build

```bash
mkdir build
cd build
cmake ..
make -j
```

The test code is now ready to run. You can run

```bash
./kerneltest
```

to check whether the build is sucessful.

## Integrate the repo into other general cmake projects

This section applys to using this repo in other general project via standard cmake build systems. In the cmake CMakeList of the project that uses graphcompiler-mlperf, please add:

```cmake
add_subdirectory(PATH/TO/graphcompiler-mlperf)
include_directories(
    PATH/TO/graphcompiler-mlperf/src
)
target_link_libraries(YOUR_BUILD_TARGET gc_mlp)
```

In the cpp code that uses the MLP code, please include:

```c++
#include <kernel/mlp.hpp>
#include <kernel/shape.hpp>
#include <kernel/pack.hpp>
```

To get the shape (blocking shape) of each parameter of MLP, please see `<kernel/shape.hpp>`.

To pack/unpack each of the parameter tensors, please see `<kernel/pack.hpp>`.

`<kernel/mlp.hpp>` exports the main function for MLP fwd and bwd.

## Example

Please check `tests/kerneltest.cpp`. It creates the buffers, packs the inputs and runs the kernel. And it also unpacks the results.

## Build with existing oneDNN source code

This git repo treats oneDNN as a 3rdparty git submodule. If your project has already had oneDNN included, you can specify the oneDNN source code to the repo, to avoid cloning oneDNN source multiple times. To do that, when calling cmake, please run:

```
cmake .. -DGC_DNNL_PATH=PATH/TO/oneDNN/SOURCE/ROOT
```




